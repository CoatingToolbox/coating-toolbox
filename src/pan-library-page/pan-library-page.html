<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../redux/redux-mixin.html">
<link rel="import" href="../my-icons.html">
<link rel="import" href="pan-library-card.html">
<link rel="import" href="pan-details-dialog.html">

<dom-module id='pan-library-page'>
    <template>
        
        <style>
            :host {
                display: block;
            }
            app-toolbar {
              background-color: var(--white-color);
              color: var(--text-color);
              height: 72px;
            }
            #content-layout {
              display: grid;
              grid-template-columns: repeat(3, 1fr);
              grid-auto-rows: auto;
              grid-gap: 32px;
              max-width: 1200px;
              margin: 48px auto;
            }
            #search-layout {
              flex-grow: 1;
              max-width: 1200px;
              margin: auto;
            }
            
            iron-icon {
              color: var(--text-light-color);
              padding: 16px;
            }
            input {
              border: none;
              height: 36px;
              background-color: inherit;
              color: var(--text-color);
              padding; 0px 8px;
              font-size: 18px;
            }
            input:focus {
              outline: none;
              border-bottom: 1px solid var(--app-primary-color);
            }
            @media(min-width: 1440px) {
                #content-layout {
                grid-template-columns: repeat(4, 1fr);
              }
            }
        </style>
        
       <app-toolbar>
          <div id='search-layout'>
            <iron-icon icon='my-icons:search'></iron-icon>
            <input id='filterInput' on-input='_filterPanLibrary' placeholder='Search Coating Pans...'>
          </div>
        </app-toolbar>
       
       <div id='content-layout'>
            
          <template is='dom-repeat' items='[[filteredLibrary]]'>
            <pan-library-card pan='[[item]]' on-show-details='_toggleDialog'></pan-library-card>
          </template>
        
        </div>
        
        <pan-details-dialog id='dialog' pan='[[selectedPan]]'></pan-details-dialog>
        
    </template>
    
    <script>
        
        /*global Polymer */
        class PanLibraryPage extends ReduxMixin(Polymer.Element) {
            static get is() { return 'pan-library-page';}
            
            static get properties() {
                return {
                  panLibrary: {
                    type: Array,
                    statePath: 'panLibrary',
                    observer: '_filterPanLibrary'
                  },
                  selectedPan: Object,
                };
            }
            
            _toggleDialog(e) {
              this.selectedPan = e.model.item;
              this.$.dialog.toggle();
            }
            
            _filterPanLibrary() {
              
              const searchProperties = ["vendorName", "nickname", "equipmentName", "companyName", "contactName", "locationName"];
              
              const searchValue = this.$.filterInput.value.toLowerCase().trim();
              
              this.filteredLibrary = this.panLibrary.filter( pan => {
                
                const searchResults = [];
                
                searchProperties.forEach( searchProperty => {
                    
                    const result = pan[searchProperty].toLowerCase().includes(searchValue);
                    searchResults.push(result);
                  
                });
                
                return searchResults.includes(true);
              
              });
              
              
            }
            
        }
        
        window.customElements.define(PanLibraryPage.is, PanLibraryPage);
        
    </script>
</dom-module>