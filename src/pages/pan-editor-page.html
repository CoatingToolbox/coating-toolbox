
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../buttons/pages-tab-button.html">
<link rel="import" href="../buttons/icon-label-button.html">
<link rel="import" href="../inputs/text-input.html">
<link rel="import" href="../inputs/unit-input.html">
<link rel="import" href="../inputs/item-select-input.html">
<link rel="import" href="../graphics/pan-schematic-layout.html">
<link rel="import" href="../redux/redux-mixin.html">
<link rel="import" href="../data/coating-pan-class.html">
<link rel="import" href="../styles/input-graphic-layout-styles.html">

<dom-module id="pan-editor-page">
  
   <template>
    
    <style include='input-graphic-layout-styles'>
      /*Details Card*/
      .card text-input[label="Name"], 
      .card text-input[label="Baffle Type"] {
        grid-column: 1/ 3;
      }
    </style>
    
    <section id='left-section'>
      <div class='card highlight top'>
        <div class='card-title'>Coating Pan Editor</div>
        <div class='card-description'>
          The Coating Pan Designer estimsates important properties of a coating 
          pan from basic dimensions and descriptions.
        </div>
      </div>
      <!--Description Section-->
      <div class='card'>
        <div class='card-title underline'>Description</div>
        <text-input value='{{pan.nickname}}' class='wide' icon='my-icons:product' label='Name'></text-input>
        <text-input value='{{pan.manufacturer}}' options='[[manufacturerOptions]]' icon='my-icons:company' label='Manufacturer'></text-input>
        <text-input value='{{pan.model}}' icon='my-icons:company' label='Model'></text-input>
        <text-input value='{{pan.company}}' icon='my-icons:contact' label='Company'></text-input>
        <text-input value='{{pan.locationName}}' icon='my-icons:location' label='Location'></text-input>
      </div>
      
      <div class='card'>
        <!--Dimensions Section-->
        <div class='card-title underline'>Dimensions</div>
        <unit-input value='{{pan.panDiameter}}' icon='my-icons:ruler' label='Main Diameter' type='length' selected-units='{{lengthUnits}}'></unit-input>
        <unit-input value='{{pan.openingDiameter}}' icon='my-icons:ruler' label='Opening Diameter' type='length' selected-units='{{lengthUnits}}'></unit-input>
        <unit-input value='{{pan.brimWidth}}' icon='my-icons:ruler' label='Depth at Brim' type='length' selected-units='{{lengthUnits}}'></unit-input>
        <unit-input value='{{pan.wallWidth}}' icon='my-icons:ruler' label='Depth along Wall' type='length' selected-units='{{lengthUnits}}'></unit-input>
      </div>
      
      <div class='card'>
        <!--Airlflow Section-->
        <div class='card-title underline'>Airflow</div>
        <item-select-input label='Pan Perforations' icon='my-icons:surface-area' items='["Fully", "Partially", "Solid"]' selected='{{pan.perforations}}'></item-select-input>
        <unit-input value='{{pan.maxAirflow}}' icon='my-icons:ruler' type='airflow' selected-units='cfm' label='Max Airflow'></unit-input>
      </div>
      
      <!--Guns Section-->
      <div class='card'>
        <div class='card-title underline'>Spray Guns</div>
        <text-input value='{{pan.gunMake}}' icon='my-icons:product' label='Manufacturer'></text-input>
        <text-input value='{{pan.gunModel}}' icon='my-icons:product' label='Model'></text-input>
        <unit-input value='{{pan.gunCount}}' icon='my-icons:count' label='Count' decimals='0' step='1' selected-units='guns'></unit-input>
        <unit-input value='{{pan.gunToGunDistance}}' icon='my-icons:ruler' type='length' selected-units='{{lengthUnits}}' label='Gun To Gun Distance'></unit-input>
      </div>
      
      <!--Baffles Section-->
      <div class='card'>
        
        <div class='card-title'>Baffles</div>
        <text-input value='{{pan.baffleType}}' class='wide' options='[[baffleOptions]]' icon='my-icons:product' label='Baffle Type'></text-input>
        <unit-input value='{{pan.baffleCount}}' icon='my-icons:count' label='Count' decimals='0' step='1' selected-units='baffles'></unit-input>
        <unit-input value='{{pan.baffleHeight}}' icon='my-icons:ruler' label='Max height' type='length' selected-units='{{lengthUnits}}'></unit-input>
      
      </div> 
      
      <div class='card underline'>
        <div class='card-title'>Calculate</div>
        <div class='card-description'>Click calcualte to save pan dimensions and volumes.</div>
        <icon-label-button class='wide' icon='my-icons:calculator' label='Calculate Pan' on-click='_save'></icon-label-button>
      
        <div id='admin-buttons' hidden$='[[!isAdmin]]'>
          <icon-label-button icon='my-icons:save' label='Save Firebase' on-click='_saveToFirebase'></icon-label-button>
          <icon-label-button icon='my-icons:save' label='Update Firebase' on-click='_replaceOnFirebase'></icon-label-button>
        </div>
      </div>  
       
    </section>
    
    <section id='right-section'>
      <iron-selector selected='{{pageSelected}}'>
          <pages-tab-button icon='my-icons:pan' label='Coating Pan'></pages-tab-button>
      </iron-selector>
      <iron-pages selected='[[pageSelected]]'>
        <div class='page'>
          <div class='card-title underline'>Coating Pan Schematic</div>
          <pan-schematic-layout pan='[[pan]]'></pan-schematic-layout>
        </div>
      </iron-pages>
      
    </section>
    
  </template>

  <script>
    class PanEditorPage extends ReduxMixin(Polymer.Element) {
      static get is() { return 'pan-editor-page'; }
      static get properties() {
        return { 
          isAdmin: {type: Boolean, statePath: 'isAdmin'},
          pan: { type: Object, statePath: 'pan'},
          lengthUnits: { type: String, value: 'in' },
          pageSelected: {type: Number, value: 0},
          manufacturerOptions: { 
            type: Array, 
            value: function() 
            {
              return [ "Thomas Engineering", "O'Hara", "GEA", "Manesty", "IMA", "Freund-Vector", "Other" ];
            }
          },
          baffleOptions: { 
            type: Array, 
            value: function() 
            {
              return [ "Ploughshare", "Shark Fin", "Helical", "Rabbit Ear", "Double Helical" ];
            }
          },
          gunOptions: { 
            type: Array, 
            value: function() 
            {
              return [ "Schlick", "Spraying Systems", "Fruend"];
            }
          },
          gunTypeOptions: { 
            type: Array, 
            value: function() 
            {
              return [ "930 Series", "970 Series", "VAU", "JAU"];
            }
          }
        };
      }
      _save() {
        this.dispatch({ 
          type: "CALCULATE_PAN",
          value: this.pan
        });
        window.scrollTo(0, 0);
        window.location = '#/home';
      }
      
      _saveToFirebase() {
        if(!this.isAdmin) { return; }
        /*global firebase */
        this.pan.firebaseKey = firebase.database().ref('pans/').push().key;
        // create a copy add copy over specific values from getters
        let pan = this._panToJSON();
        firebase.database().ref(`pans/${pan.firebaseKey}`).set(pan);
      }
      _replaceOnFirebase() {
        // if(!this.isAdmin) { return; }
        
        let pan = this._panToJSON();
        if(pan.firebaseKey) {
          /*global firebase */
          firebase.database().ref(`pans/${pan.firebaseKey}`).set(pan);
        } else {
          console.log('could not replace firebase so loaded as new');
          this._saveToFirebase();
        }
      }
      // Convert pan class to JSON and add save certain getter values
      _panToJSON() {
        let pan = Object.assign({}, this.pan);
        pan.diameterInInchesString = this.pan.diameterInInchesString;
        pan.brimVolumeInLitersString = this.pan.brimVolumeInLitersString;
      }
    }

    window.customElements.define(PanEditorPage.is, PanEditorPage);
  </script>
</dom-module>
