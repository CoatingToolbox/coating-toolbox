
<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../elements/inputs/text-input.html">
<link rel="import" href="../../elements/inputs/unit-input.html">
<link rel="import" href="../../elements/buttons/icon-label-button.html">
<link rel="import" href="../../elements/cards/tagged-card.html">
<link rel="import" href="../../elements/graphics/tablet-graphic.html">
<link rel="import" href="../../elements/charts/bulk-density-chart.html">
<link rel="import" href="../../elements/my-icons.html">
<link rel="import" href="../../redux/redux-mixin.html">
<link rel="import" href="../../data/tablet-class.html">

<dom-module id="tablet-designer-section">
  
   <template>
    
    <style>
      :host {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        grid-auto-row: auto;
        grid-gap: 32px 48px;
        max-width: 932px;
        margin: auto;
        padding: 48px 16px;
      }
      
      /*Main Layout*/
      #page-title {
        grid-column: 1 / 13;
        grid-row: 1 / 2; 
        padding-bottom: 32px;
        color: var(--text-light-color);
        @apply --paper-font-display1;
      }
      tagged-card[title='Introduction'] {
        grid-column: 1 / 13;
        grid-row: 2 / 3;
      }
      tagged-card[title='Description'] {
        grid-column: 1 / 10;
        grid-row: 3 / 4;
      }
      tagged-card[title='Shape'] {
        grid-column: 1 / 13;
        /*grid-row: 4 / 5;*/
      }
      tagged-card[title='Dimensions'] {
        grid-column: 1 / 7;
        /*grid-row: 4 / 5;*/
      }
      tagged-card[title='Thickness'] {
        grid-column: 7 / 13;
        /*grid-row: 4 / 5;*/
      }
      tagged-card[title='Weight'] {
        grid-column: 1 / 7;
        /*grid-row: 5 / 6;*/
      }
      tagged-card[title='Bulk Density'] {
        grid-column: 7 / 13;
        /*grid-row: 5 / 6;*/
      }
      #button-layout {
        grid-column: 1 / 13;
        display: flex;
        justify-content: flex-end;
      }
      #button-layout icon-label-button + icon-label-button {
        margin-left: 16px;
      }
      
      /*Styles for intor card*/
      #intro-layout {
        display: grid;
        grid-template-columns: 124px auto;
        grid-template-rows: auto auto auto;
        grid-gap: 16px 48px;
        padding: 24px 48px;
      }
      #intro-icon-layout {
        grid-row: 1 / 3;
        grid-column: 1 / 2;
        align-self: center;
        justify-self: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 16px;
        border-radius: 50%;
        background-color: var(--gray-color);
        border: 4px solid var(--app-light-color);
      }
      #intro-icon {
        height: 100%;
        width: 100%;
        color: var(--app-light-color);
      }
      #intro-title {
        grid-column: 2 / 3;
        grid-row: 1 / 2;
        color: var(--app-primary-color);
        @apply --paper-font-headline;
      }
      #intro-description {
        grid-column: 2 / 3;
        grid-row: 2 / 3;
        @apply --paper-font-body2;
      }
      
      /*Styles for the description page*/
      #description-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-auto-rows: auto;
        grid-gap: 24px;
        padding: 24px;
      }
      #description-layout text-input[label="Product"] {
        grid-column: 1 / 3;
      }
      
      /*Shape Card*/
      #shape-layout {
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        padding: 48px;
      }
      #shape-layout .shape-icon {
        display: flex;
        flex-direction: column;
        /*justify-content: center;*/
        align-items: center;
        padding: 16px 32px;
        background-color: var(--gray-color);
        border-radius: 16px;
        @apply --paper-font-title;
        color: var(--text-light-color);
        border: 2px solid var(--text-light-color);
        --iron-icon-stroke-color: var(--text-light-color);
        transition: all 0.2s;
      }
      #shape-layout .shape-icon:hover {
        cursor: pointer;
        transform: scale(1.1);
        transition: all 0.2s;
      }
      #shape-layout .iron-selected {
        color: var(--app-primary-color);
        border-color: var(--app-primary-color);
        --iron-icon-stroke-color: var(--app-primary-color);
        transition: all 0.2s;
        
      }
      #shape-layout iron-icon {
        flex-grow: 1;
        width: 124px;
        height: 124px;
      }
      
      /*specific element placement and styles*/
      tablet-graphic {
        flex-grow: 1;
        align-self: center;
        justify-self: center;
      }
      bulk-density-chart {
        width: 100%;
        margin: 24px 0px 32px;
        flex-grow: 1;
        align-self: center;
        justify-self: center;
      }
      
      /*Inputs for dimension thickness, weight and bulk density*/
      unit-input {
        align-self: center;
      }
      .input-layout {
        display: flex;
        justify-content: center;
      }
      .input-layout unit-input {
        flex-grow: 1;
        margin: 16px 8px;
      }
      
      /*A few itmes are conditionally hidden*/
      [hidden] {
        display: none;
      } 
    </style>
    
    <div id='page-title'>Tablet Designer</div>
    <tagged-card title='Introduction'>
        <div id='intro-layout'>
          <div id='intro-icon-layout'>
            <iron-icon id='intro-icon' icon='my-icons:tablet'></iron-icon>
          </div>
          <div id='intro-title'>Tablet Designer</div>
          <div id='intro-description'>The Tablet Designer allows estimates important properties of a tablet. Starting with a compressed tablet input a few easy measurements like length, 
          thickness, and weight to caluclate the tablets surface area, volume and more.</div>
        </div>
    </tagged-card>
      
    <tagged-card title='Description'>
        <div id='description-layout'>
          <text-input value='{{_tablet.productName}}' icon='my-icons:product' label='Product'></text-input>
          <text-input value='{{_tablet.formulationName}}' icon='my-icons:product' label='Formulation'></text-input>
          <text-input value='{{_tablet.companyName}}' icon='my-icons:company' label='Brand / Company'></text-input>
          <text-input value='{{_tablet.productType}}' icon='my-icons:product' label='Industry' options='["Pharmaceutical", "Dietary Supplment", "OTC"]'></text-input>
          <text-input value='{{_tablet.contactName}}' icon='my-icons:contact' label='Contact'></text-input>
          </div>
    </tagged-card>
    
    <tagged-card title='Shape'>
        <iron-selector id='shape-layout' selected='{{_tablet.shape}}' attr-for-selected='shape'>
          <div class='shape-icon' shape='round'>
            <iron-icon icon='my-icons:round-tablet'></iron-icon>
            <div>Round</div>
          </div>
          <div class='shape-icon' shape='oval'>
            <iron-icon icon='my-icons:oval-tablet'></iron-icon>
            <div>Oval</div>
          </div>
          <div class='shape-icon' shape='caplet'>
            <iron-icon icon='my-icons:caplet-tablet'></iron-icon>
            <div>Caplet</div>
          </div>
        </iron-selector>
    </tagged-card>
    
    <tagged-card title='Dimensions'>
      <tablet-graphic top-view tablet='[[_graphicTablet]]'></tablet-graphic>
      <div class='input-layout'>
        <unit-input value='{{_tablet.length}}' icon='my-icons:ruler' label='Length' type='length' selected-units='{{lengthUnits}}'></unit-input>
        <unit-input hidden$='{{_isRound(_tablet.shape)}}' value='{{_tablet.width}}' icon='my-icons:ruler' label='Width' type='length' selected-units='{{lengthUnits}}'></unit-input>
      </div>
    </tagged-card>
    
    <tagged-card title='Thickness'>
      <tablet-graphic length-view tablet='[[_graphicTablet]]'></tablet-graphic>
      <div class='input-layout'>
        <unit-input value='{{_tablet.totalThickness}}' icon='my-icons:ruler' label='Total Thickness' type='length' selected-units='{{lengthUnits}}'></unit-input>
        <unit-input value='{{_tablet.bandThickness}}' icon='my-icons:ruler' label='Band Thickness' type='length' selected-units='{{lengthUnits}}'></unit-input>          
      </div>
    </tagged-card>
  
    <tagged-card title='Weight'>
      <unit-input value='{{_tablet.weight}}' icon='my-icons:weight' label='Weight' type='weight' selected-units='mg'></unit-input>
    </tagged-card>
  
    <tagged-card title='Bulk Density'>
      <bulk-density-chart bulk-density='{{_tablet.bulkDensity}}'></bulk-density-chart>
      <unit-input value='{{_tablet.bulkDensity}}' icon='my-icons:density' label='Bulk Density' type='density' selected-units='g/ml'></unit-input>
    </tagged-card>
    
    <div id='button-layout'>
      <icon-label-button on-click='_cancel' label='Cancel' icon='my-icons:close'></icon-label-button>
      <icon-label-button on-click='_save' highlight label='Calculate Tablet' icon='my-icons:calculator'></icon-label-button>
    </div>
    
  </template>

  <script>
    class TabletDesignerSection extends ReduxMixin(Polymer.Element) {
      static get is() { return 'tablet-designer-section'; }
      static get properties() {
        return { 
          tablet: { type: Object, statePath: 'tablet', notify: false },
          _tablet: Object,
          _graphicTablet: Object,
          lengthUnits: { type: String, value: 'mm' }
        };
      }
      
      // Oberserves and functions
      static get observers() {
        return [
          '_calcGraphicTablet(_tablet.*)',
          '_calcTablet(tablet.*)',
        ];
      }
      // we need to create a tablet from a new class for all the values required to graphic show the tablet.
      _calcGraphicTablet() {
        this._graphicTablet = new Tablet(this._tablet);
      }
      // we need to create a tablet from a new class for all the values required to graphic show the tablet.
      _calcTablet() {
        this._tablet = new Tablet(this.tablet);
      }
      
      // Event functions
      _cancel() {
        let tablet = new Tablet(this.tablet).toJSON();
        this.dispatch({ 
          type: "LOAD_TABLET",
          tablet: tablet
        });
        window.location = '#/tablet/overview';
      }
      _save() {
        let tablet = new Tablet(this._tablet).toJSON();
        this.dispatch({ 
          type: "LOAD_TABLET",
          tablet: tablet
        });
        window.location = '#/tablet/overview';
      }
      
      // Supported functions 
      _isRound(shape) {
        return (shape === 'round');
      }
    }

    window.customElements.define(TabletDesignerSection.is, TabletDesignerSection);
  </script>
</dom-module>
