
<script src="../../node_modules/redux/dist/redux.min.js"></script>

<link rel="import" href="../../bower_components/polymer-redux/polymer-redux.html">
<link rel="import" href="../data/coating-pan-class.html">
<link rel="import" href="../data/coating-formula-class.html">
<link rel="import" href="../data/tablet-class.html">

<script>
  
    
    const storedState = JSON.parse(sessionStorage.getItem('coating-toolbox-state')) || {};
    
    
    const initialTablet = storedState.tablet || {
        shape: 'round',
        length: 0.01,
        width: 0.0075,
        totalThickness: 0.00475,
        bandThickness: 0.00275,
        weight: 0.4,
        bulkDensity: 760000,
        productType: 'Pharmaceutical',
        productName: 'Colorcon Round Placebo',
        formulationName: 'Placebo WP2',
        companyName: 'Colorcon',
        contactName: 'Jason Hansell'
    };
    
    const initialPan = storedState.pan || {
        panDiameter: 1.2192,
        openingDiameter: 0.4826,
        wallWidth: 0.508,
        brimWidth: 0.93345,
        model: "Fastcoat",
        manufacturer: "O'Hara",
        nickname: "O'Hara Fastcoat 48\" Room",
        company: 'Colorcon',
        locationName: 'Harlyesville, PA',
        baffleType: 'Ploughshare',
        baffleCount: '4',
        baffleHeight: '',
        gunMake: 'Schlick',
        gunModel: '930',
        gunCount: '3',
        gunToGunDistance: '0.1524',
        maxAirflow: '2000',
        perforations: 'Fully',
        firebaseKey: ''
    };
    
    const initialCoatingFormula = storedState.coatingFormula || {
        productName: 'Opadry II 85F Series',
        formulaName: '85F18422',
        type: 'Immediate',
        color: 'White'
    };
    
    // create an initial state 
    const initialState = {
        isAdmin: false,
        pan: new CoatingPan(initialPan),                    /*global CoatingPan*/
        tablet: new Tablet(initialTablet),                       /*global Tablet*/
        coatingFormula: new CoatingFormula(initialCoatingFormula)        /*global CoatingFormula*/
    };
    
    // create a reducer for actions
    const reducer = (state = initialState, action) => {
        let newState = Object.assign({}, state);
        switch(action.type) {
            case "SET_ADMIN":
                newState.isAdmin = action.value;
                break;
            case "CALCULATE_TABLET":
                newState.tablet = new Tablet(action.value);
                break;
            case "CALCULATE_PAN":
                newState.pan = new CoatingPan(action.value);
                break;
            case "CALCULATE_COATING_FORMULA":
                newState.coatingFormula = new CoatingFormula(action.value);
                break;
            case "SET_BATCH_WEIGHT":
                newState.tablet.batchWeight = action.value;
                break;
            case "SET_BATCH_VOLUME":
                newState.tablet.batchVolume = action.value;
                break;
            case "SET_BATCH_COUNT":
                newState.tablet.count = action.value;
                break;
        }
        
        // We set the properties and pass to new coating pan because most 
        // elements are watching the pan path not individual propetry paths
        newState.pan.batchVolume = newState.tablet.batchVolume;
        newState.pan.batchBulkDensity = newState.tablet.bulkDensity;
        newState.pan = new CoatingPan(newState.pan);
        
        // Save current state to session storage
        sessionStorage.setItem('coating-toolbox-state', JSON.stringify(newState));
        
        // return the state to be handled
        return newState;
    };
    
    // create the redux store
    /* global Redux */
    const store = Redux.createStore(reducer);
    
    // pass the redux store to the PolymerRedux to create a mixing which is used with other polymer elements
    /* global PolymerRedux*/
    const ReduxMixin = PolymerRedux(store);
    
</script>

