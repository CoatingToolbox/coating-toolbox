
<script src="../../node_modules/redux/dist/redux.min.js"></script>
<script src="tablet.js"></script>
<script src="pan.js"></script>
<script src="batch.js"></script>
<script src="coating.js"></script>
<link rel="import" href="../../bower_components/polymer-redux/polymer-redux.html">

<script>
/* global Redux PolymerRedux Tablet Batch Pan Coating*/

// INITIAL & SESSION STORED STATE
const initialTablet = JSON.parse(sessionStorage.getItem('coating-toolbox-tablet')) || {
        shape: 'round',
        length: 0.01,
        width: 0.0075,
        totalThickness: 0.00475,
        bandThickness: 0.00275,
        weight: 0.4,
        bulkDensity: 760000,
        productType: 'Pharmaceutical',
        productName: 'Colorcon Round Placebo',
        formulationName: 'Placebo WP2',
        companyName: 'Colorcon',
        contactName: 'Jason Hansell'
    };
const initialPan = JSON.parse(sessionStorage.getItem('coating-toolbox-pan')) || new Pan({
        panDiameter: 1.2192,
        openingDiameter: 0.4826,
        wallWidth: 0.508,
        brimWidth: 0.93345,
        model: "Fastcoat",
        manufacturer: "O'Hara",
        nickname: "O'Hara Fastcoat 48\" Room",
        company: 'Colorcon',
        locationName: 'Harlyesville, PA',
        baffleType: 'Ploughshare',
        baffleCount: '4',
        baffleHeight: '',
        gunMake: 'Schlick',
        gunModel: '930',
        gunCount: '3',
        gunToGunDistance: '0.1524',
        maxAirflow: '2000',
        perforations: 'Fully',
        firebaseKey: ''
    }).toJSON();
const initialCoating = JSON.parse(sessionStorage.getItem('coating-toolbox-coating')) || new Coating({
    productName: 'Opadry II 85F Series',
    formulaName: '85F18422',
    type: 'Immediate',
    color: 'White',
    // VISCOSITY
    solids: 0.2,
    viscosityIntercept: 20,
    viscosityExponent: 10,
    // COATING AMOUNT
    density: 1100000,
    weightGain: 0.03,
    // TABLET PROPERTIES
    tabletWeight: 0.4,
    batchWeight: 120000,
    tabletArea: 0.01,
}).toJSON();
let initialBatch = new Batch(initialPan);
initialBatch.tabletWeight = initialTablet.weight;
initialBatch.bulkDensity = initialTablet.bulkDensity;
initialBatch = initialBatch.toJSON();
const initialApp = { isAdmin: false};

const initialState = {
    tablet: initialTablet,
    pan: initialPan,
    coating: initialCoating,
    batch: initialBatch,
    app: initialApp
}
// REDUCERS
function reducer(state = initialState, action) {
    
    let tablet = new Tablet(state.tablet);
    let pan = new Pan(state.pan);
    let coat = new Coating(state.coating);
    let batch = new Batch(state.batch);
    
    switch(action.type) {
        case "SET_TABLET_PRODUCT_NAME": tablet.productName = action.value; break;
        case "SET_TABLET_FORMULATION_NAME": tablet.formulationName = action.value; break;
        case "SET_TABLET_CONTACT_NAME": tablet.contactName = action.value; break;
        case "SET_TABLET_COMPANY_NAME": tablet.companyName = action.value; break;
        case "SET_TABLET_PRODUCT_TYPE": tablet.productType = action.value; break;
        case "SET_TABLET_SHAPE": tablet.shape = action.value; break;
        case "SET_TABLET_WIDTH": tablet.width = action.value; break;
        case "SET_TABLET_LENGTH": tablet.length = action.value; break;
        case "SET_TABLET_TOTAL_THICKNESS": tablet.totalThickness = action.value; break;
        case "SET_TABLET_BAND_THICKNESS": tablet.bandThickness = action.value; break;
        case "SET_TABLET_WEIGHT": tablet.weight = action.value; break;
        case "SET_TABLET_BULK_DENSITY": tablet.bulkDensity = action.value; break;
        case "LOAD_TABLET_FROM_LIBRARY": tablet = new Tablet(action.value); break;
        case "SET_PAN_NICKNAME": pan.nickname = action.value; break;
        case "SET_PAN_MANUFACTURER": pan.manufacturer = action.value; break;
        case "SET_PAN_MODEL": pan.model = action.value; break;
        case "SET_PAN_COMPANY": pan.company = action.value; break;
        case "SET_PAN_LOCATION_NAME": pan.locationName = action.value; break;
        case "SET_PAN_DIAMETER": pan.panDiameter = action.value; break;
        case "SET_PAN_OPENING_DIAMETER": pan.openingDiameter = action.value; break;
        case "SET_PAN_BRIM_WIDTH": pan.brimWidth = action.value; break;
        case "SET_PAN_WALL_WIDTH": pan.wallWidth = action.value; break;
        case "SET_PAN_PERFORATIONS": pan.perforations = action.value; break;
        case "SET_PAN_MAX_AIRFLOW": pan.maxAirflow = action.value; break;
        case "SET_PAN_GUN_MAKE": pan.gunMake = action.value; break;
        case "SET_PAN_GUN_MODEL": pan.gunModel = action.value; break;
        case "SET_PAN_GUN_COUNT": pan.gunCount = action.value; break;
        case "SET_PAN_GUN_TO_GUN_DISTANCE": pan.gunToGunDistance = action.value; break;
        case "SET_PAN_BAFFLE_TYPE": pan.baffleType = action.value; break;
        case "SET_PAN_BAFFLE_COUNT": pan.baffleCount = action.value; break;
        case "SET_PAN_BAFFLE_HEIGHT": pan.baffleHeight = action.value; break;
        case "LOAD_PAN_FROM_LIBRARY": pan = new Pan(action.value); break;
        case "SET_COATING_PRODUCT_NAME": coat.productName = action.value; break;
        case "SET_COATING_FORMULA_NAME": coat.formulaName = action.value; break;
        case "SET_COATING_COLOR": coat.color = action.value; break;
        case "SET_COATING_TYPE": coat.type = action.value; break;
        case "SET_COATING_DENSITY": coat.density = action.value; break;
        case "SET_COATING_VISCOSITY_INTERCEPT": coat.viscosityIntercept = action.value; break;
        case "SET_COATING_VISCOSITY_EXPONENT": coat.viscosityExponent = action.value; break;
        case "SET_COATING_SOLIDS": coat.solids = action.value; break;
        case "LOAD_COATING_FROM_LIBRARY": coat = new Coating(action.value); break;
        case "SET_BATCH_WEIGHT": batch.batchWeight = action.value; break;
        case "SET_BATCH_VOLUME": batch.batchVolume = action.value; break;
        case "SET_BATCH_COUNT": batch.tabletCount = action.value; break;
        case "SET_BATCH_TO_MAX_WEIGHT": batch.batchWeight = batch.maxFillWeight; break;
        case "SET_BATCH_TO_MIN_WEIGHT": batch.batchWeight = batch.minFillWeight; break;
        case "SET_BATCH_PERCENT_VOLUME": batch.batchVolume = action.value * batch.brimVolume; break;
        case "SET_ADMIN": state.app.isAdmin = action.value;
    }
    
    batch = new Batch(Object.assign({}, batch, state.pan, state.tablet));
    
    return Object.assign({}, state, 
        {coating: coat.toJSON()}, 
        {batch: batch.toJSON()},
        {pan: pan.toJSON()},
        {tablet: tablet.toJSON()}
    );
    
}
function tabletReducer(state = initialTablet, action) {
    
    let tablet = new Tablet(state);
    
    switch(action.type) {
        case "SET_TABLET_PRODUCT_NAME": tablet.productName = action.value; break;
        case "SET_TABLET_FORMULATION_NAME": tablet.formulationName = action.value; break;
        case "SET_TABLET_CONTACT_NAME": tablet.contactName = action.value; break;
        case "SET_TABLET_COMPANY_NAME": tablet.companyName = action.value; break;
        case "SET_TABLET_PRODUCT_TYPE": tablet.productType = action.value; break;
        case "SET_TABLET_SHAPE": tablet.shape = action.value; break;
        case "SET_TABLET_WIDTH": tablet.width = action.value; break;
        case "SET_TABLET_LENGTH": tablet.length = action.value; break;
        case "SET_TABLET_TOTAL_THICKNESS": tablet.totalThickness = action.value; break;
        case "SET_TABLET_BAND_THICKNESS": tablet.bandThickness = action.value; break;
        case "SET_TABLET_WEIGHT": tablet.weight = action.value; break;
        case "SET_TABLET_BULK_DENSITY": tablet.bulkDensity = action.value; break;
        case "LOAD_TABLET_FROM_LIBRARY": tablet = new Tablet(action.value); break;
    }
    sessionStorage.setItem('coating-toolbox-tablet', JSON.stringify(tablet));
    return Object.assign({}, state, tablet.toJSON());
}
function panReducer(state = initialPan, action) {
    
    let pan = new Pan(state);
    switch(action.type) {
            case "SET_PAN_NICKNAME": pan.nickname = action.value; break;
            case "SET_PAN_MANUFACTURER": pan.manufacturer = action.value; break;
            case "SET_PAN_MODEL": pan.model = action.value; break;
            case "SET_PAN_COMPANY": pan.company = action.value; break;
            case "SET_PAN_LOCATION_NAME": pan.locationName = action.value; break;
            case "SET_PAN_DIAMETER": pan.panDiameter = action.value; break;
            case "SET_PAN_OPENING_DIAMETER": pan.openingDiameter = action.value; break;
            case "SET_PAN_BRIM_WIDTH": pan.brimWidth = action.value; break;
            case "SET_PAN_WALL_WIDTH": pan.wallWidth = action.value; break;
            case "SET_PAN_PERFORATIONS": pan.perforations = action.value; break;
            case "SET_PAN_MAX_AIRFLOW": pan.maxAirflow = action.value; break;
            case "SET_PAN_GUN_MAKE": pan.gunMake = action.value; break;
            case "SET_PAN_GUN_MODEL": pan.gunModel = action.value; break;
            case "SET_PAN_GUN_COUNT": pan.gunCount = action.value; break;
            case "SET_PAN_GUN_TO_GUN_DISTANCE": pan.gunToGunDistance = action.value; break;
            case "SET_PAN_BAFFLE_TYPE": pan.baffleType = action.value; break;
            case "SET_PAN_BAFFLE_COUNT": pan.baffleCount = action.value; break;
            case "SET_PAN_BAFFLE_HEIGHT": pan.baffleHeight = action.value; break;
            case "LOAD_PAN_FROM_LIBRARY": pan = new Pan(action.value); break;
    }
    sessionStorage.setItem('coating-toolbox-pan', JSON.stringify(pan));
    return Object.assign({}, state, pan.toJSON());
}
function coatingReducer(state = initialCoating, action) {
    
    let coat = new Coating(state);
    switch(action.type) {
        case "SET_COATING_PRODUCT_NAME": coat.productName = action.value; break;
        case "SET_COATING_FORMULA_NAME": coat.formulaName = action.value; break;
        case "SET_COATING_COLOR": coat.color = action.value; break;
        case "SET_COATING_TYPE": coat.type = action.value; break;
        case "SET_COATING_DENSITY": coat.density = action.value; break;
        case "SET_COATING_VISCOSITY_INTERCEPT": coat.viscosityIntercept = action.value; break;
        case "SET_COATING_VISCOSITY_EXPONENT": coat.viscosityExponent = action.value; break;
        case "SET_COATING_SOLIDS": coat.solids = action.value; break;
        case "LOAD_COATING_FROM_LIBRARY": coat = new Coating(action.value); break;
    }
    sessionStorage.setItem('coating-toolbox-coating', JSON.stringify(coat));
    return Object.assign({}, state, coat.toJSON());
}
function batchReducer(state = initialBatch, action) {
    let batch = new Batch(Object.assign({}, action.pan, action.tablet));
    console.log(batch.brimHeight);
    switch(action.type) {
      case "SET_TABLET_WEIGHT": batch.tabletWeight = action.value; break;
      case "SET_TABLET_BULK_DENSITY": batch.bulkDensity = action.value; break;
      case "LOAD_TABLET_FROM_LIBRARY": 
          batch.tabletWeight = action.value.weight; 
          batch.bulkDensity = action.value.bulkDensity; 
          break;
      case "SET_PAN_DIAMETER": batch.panDiameter = action.value; break;
      case "SET_PAN_OPENING_DIAMETER": batch.openingDiameter = action.value; break;
      case "SET_PAN_BRIM_WIDTH": batch.brimWidth = action.value; break;
      case "SET_PAN_WALL_WIDTH": batch.wallWidth = action.value; break;
      case "LOAD_PAN_FROM_LIBRARY": 
          batch = new Batch(Object.assign({}, batch, action.value)); 
          break;
      case "SET_BATCH_WEIGHT": batch.batchWeight = action.value; break;
      case "SET_BATCH_VOLUME": batch.batchVolume = action.value; break;
      case "SET_BATCH_COUNT": batch.tabletCount = action.value; break;
      case "SET_BATCH_TO_MAX_WEIGHT": batch.batchWeight = batch.maxFillWeight; break;
      case "SET_BATCH_TO_MIN_WEIGHT": batch.batchWeight = batch.minFillWeight; break;
      case "SET_BATCH_PERCENT_VOLUME": batch.batchVolume = action.value * batch.brimVolume; break;
    }
    return Object.assign({}, state, batch.toJSON());
}
function appReducer(state = initialApp, action) {
    switch(action.type) {
        case "SET_ADMIN":
            return Object.assign({}, state, {isAdmin: action.value});
        default: 
            return state;
    }
}  

// CREATE STORE AND MIXIN
// const store = Redux.createStore(Redux.combineReducers({
//     tablet: tabletReducer, 
//     pan: panReducer, 
//     coating: coatingReducer,
//     batch: batchReducer,
//     app: appReducer}));
const store = Redux.createStore(reducer);
const ReduxMixin = PolymerRedux(store); 
    
</script>