
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../elements/list-unit-input.html">
<link rel="import" href="../redux/redux-mixin.html">

<dom-module id="batch-size">
  <template>
    <style>
      :host {
        display: block;
        padding: 48px 64px 72px 64px;
      }
      .title {
        @apply --paper-font-title;
      }
      #description {
        @apply --paper-font-body1;
        color: var(--text-light-color);
        margin: 16px auto;
        max-width: 600px;
        text-align: justify;
      }
      list-unit-input {
        max-width: 600px;
        margin: auto;
      }
      list-unit-input + list-unit-input {
        border-top: 2px solid var(--border-color);
      }
    </style>
    
    <div class='title'>Volume, Weight and Count</div>
    <div id='description'>
      The batch size of the coating process can be described in different ways. Common values are
      the batch weight and product count. These values are often used out of conveniences but in the 
      coating process we need to understand the batch volume. Based on the tablet weight and bulk density
      we can see how the batch volume, weight and count are related below.
    </div>
    
    <!--<div class='title'>Customize Batch Size</div>-->
    
    
    <list-unit-input 
      icon='my-icons:weight'
      title='Product Weight'
      subtitle='Desired batch weight.'
      decimals='1'
      type='weight'
      selected-units='kg'
      value='[[weight]]'
      on-value-changed='_weightChanged' >
    </list-unit-input>
    
    <list-unit-input
      icon='my-icons:volume'
      title='Product Volume'
      subtitle='[[_volumeSubtitle(tabletDensity)]]'
      decimals='1'
      selected-units='l'
      type='volume'
      value='[[volume]]'
      on-value-changed='_volumeChanged' >
    </list-unit-input>
    
    <list-unit-input
      icon='my-icons:count'
      title='Product Count'
      subtitle='[[_countSubtitle(tabletWeight)]]'
      decimals='0'
      selected-units='tablets'
      type='count'
      value='[[count]]'
      on-value-changed='_countChanged'>
    </list-unit-input>

  </template>

  <script>
    class BatchSize extends ReduxMixin(Polymer.Element) {
      static get is() { return 'batch-size'; }
      
      static get properties() {
        return {
          volume: {type: Number, statePath: "batch.volume"},
          weight: {type: Number, statePath: "batch.weight"},
          count: {type: Number, statePath: "batch.count"},
          tabletWeight: {type: Number, statePath: "batch.tablet.weight"},
          tabletDensity: {type: Number, statePath: "batch.tablet.bulkDensity"}
        };
      }
    _countSubtitle(weight) {
      return `With a ${(weight * 1000).toFixed(1)} mg product weight.`;
    } 
    
    _volumeSubtitle(density) {
      return `With a ${ (density * 1e-6).toFixed(2) } g/ml bulk density.`;
    } 
    _countChanged(e) {
      this.dispatch({
        type: "SET_BATCH_COUNT",
        value: e.target.value
      }); 
    }
    _volumeChanged(e) {
      this.dispatch({
        type: "SET_BATCH_VOLUME",
        value: e.target.value
      }); 
    }
    _weightChanged(e) {
      this.dispatch({
        type: "SET_BATCH_WEIGHT",
        value: e.target.value
      }); 
    }
      
    }

    window.customElements.define(BatchSize.is, BatchSize);
  </script>
</dom-module>
